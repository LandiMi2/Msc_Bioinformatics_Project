Building DAG of jobs...
Using shell: /bin/bash
Provided cores: 4
Rules claiming more threads will be scaled down.
Job counts:
	count	jobs
	1	all
	2	check_parsing
	1	copy_final_j_database
	1	copy_final_v_database
	2	dendrogram
	2	igdiscover_clusterplot
	6	igdiscover_count
	1	igdiscover_discover
	1	igdiscover_discover_j
	2	igdiscover_filter
	2	igdiscover_germlinefilter
	2	igdiscover_igblast
	1	json_stats
	1	json_stats_nofinal
	2	plot_errorhistograms
	1	read_length_histogram
	28

[Tue Sep 10 10:15:06 2019]
rule igdiscover_igblast:
    input: reads/sequences.fasta.gz, iteration-01/database/V.fasta, iteration-01/database/D.fasta, iteration-01/database/J.fasta
    output: iteration-01/assigned.tab.gz, iteration-01/stats/assigned.json
    log: iteration-01/igblast.log
    jobid: 37
    wildcards: dir=iteration-01
    threads: 4

time igdiscover igblast --sequence-type=Ig --threads=4 --stats=iteration-01/stats/assigned.json iteration-01/database reads/sequences.fasta.gz | gzip 2>&1 > iteration-01/assigned.tab.gz | tee iteration-01/igblast.log >&2
[Tue Sep 10 10:16:26 2019]
Finished job 37.
1 of 28 steps (4%) done

[Tue Sep 10 10:16:26 2019]
rule read_length_histogram:
    input: reads/sequences.fasta.gz
    output: stats/readlengths.txt, stats/readlengths.pdf
    jobid: 12

sqt readlenhisto --bins 100 --left 300 --title "Lengths of pre-processed reads" --plot stats/readlengths.pdf reads/sequences.fasta.gz  > stats/readlengths.txt

[Tue Sep 10 10:16:26 2019]
rule check_parsing:
    input: iteration-01/stats/assigned.json
    output: iteration-01/stats/parsing-successful
    jobid: 38
    wildcards: dir=iteration-01

[Tue Sep 10 10:16:26 2019]
Finished job 38.
2 of 28 steps (7%) done

[Tue Sep 10 10:16:26 2019]
rule igdiscover_filter:
    input: iteration-01/assigned.tab.gz, iteration-01/stats/parsing-successful
    output: iteration-01/filtered.tab.gz, iteration-01/stats/filtered.json
    jobid: 26
    wildcards: dir=iteration-01

[Tue Sep 10 10:16:27 2019]
Finished job 12.
3 of 28 steps (11%) done
[Tue Sep 10 10:16:29 2019]
Finished job 26.
4 of 28 steps (14%) done

[Tue Sep 10 10:16:29 2019]
rule igdiscover_discover:
    input: iteration-01/database/V.fasta, iteration-01/filtered.tab.gz
    output: iteration-01/candidates.tab, iteration-01/read_names_map.tab
    jobid: 9
    wildcards: dir=iteration-01
    threads: 4

time igdiscover discover -j 4 --seed=1 --d-coverage=70 --read-names=iteration-01/read_names_map.tab --subsample=1000 --database=iteration-01/database/V.fasta iteration-01/filtered.tab.gz > iteration-01/candidates.tab
[Tue Sep 10 10:16:57 2019]
Finished job 9.
5 of 28 steps (18%) done

[Tue Sep 10 10:16:57 2019]
rule plot_errorhistograms:
    input: iteration-01/filtered.tab.gz
    output: iteration-01/errorhistograms.pdf, iteration-01/v-shm-distributions.pdf
    jobid: 2
    wildcards: dir=iteration-01

igdiscover errorplot --multi=iteration-01/errorhistograms.pdf --boxplot=iteration-01/v-shm-distributions.pdf iteration-01/filtered.tab.gz

[Tue Sep 10 10:16:57 2019]
rule igdiscover_clusterplot:
    input: iteration-01/filtered.tab.gz
    output: iteration-01/clusterplots/done
    jobid: 1
    wildcards: dir=iteration-01

igdiscover clusterplot iteration-01/filtered.tab.gz iteration-01/clusterplots/ && touch iteration-01/clusterplots/done

[Tue Sep 10 10:16:57 2019]
rule igdiscover_count:
    input: iteration-01/filtered.tab.gz
    output: iteration-01/expressed_V.pdf, iteration-01/expressed_V.tab
    jobid: 3
    wildcards: dir=iteration-01, gene=V

igdiscover count --gene=V --allele-ratio=0.2 --plot=iteration-01/expressed_V.pdf iteration-01/filtered.tab.gz > iteration-01/expressed_V.tab

[Tue Sep 10 10:16:57 2019]
rule igdiscover_discover_j:
    input: iteration-01/database/J.fasta, iteration-01/filtered.tab.gz
    output: iteration-01/new_J.tab, iteration-01/new_J.fasta
    jobid: 16

time igdiscover discoverj --allele-ratio=0.2 --cross-mapping-ratio=0.1 --database=iteration-01/database/J.fasta --fasta=iteration-01/new_J.fasta iteration-01/filtered.tab.gz > iteration-01/new_J.tab
[Tue Sep 10 10:16:58 2019]
Finished job 16.
6 of 28 steps (21%) done

[Tue Sep 10 10:16:59 2019]
rule igdiscover_count:
    input: iteration-01/filtered.tab.gz
    output: iteration-01/expressed_J.pdf, iteration-01/expressed_J.tab
    jobid: 5
    wildcards: dir=iteration-01, gene=J

igdiscover count --gene=J --allele-ratio=0.2 --plot=iteration-01/expressed_J.pdf iteration-01/filtered.tab.gz > iteration-01/expressed_J.tab
[Tue Sep 10 10:16:59 2019]
Finished job 3.
7 of 28 steps (25%) done

[Tue Sep 10 10:16:59 2019]
rule igdiscover_count:
    input: iteration-01/filtered.tab.gz
    output: iteration-01/expressed_D.pdf, iteration-01/expressed_D.tab
    jobid: 4
    wildcards: dir=iteration-01, gene=D

igdiscover count --gene=D --allele-ratio=0.2 --plot=iteration-01/expressed_D.pdf iteration-01/filtered.tab.gz > iteration-01/expressed_D.tab
[Tue Sep 10 10:17:00 2019]
Finished job 5.
8 of 28 steps (29%) done

[Tue Sep 10 10:17:00 2019]
rule igdiscover_germlinefilter:
    input: iteration-01/candidates.tab, database/V.fasta
    output: iteration-01/new_V_germline.tab, iteration-01/new_V_germline.fasta, iteration-01/annotated_V_germline.tab
    log: iteration-01/new_V_germline.log
    jobid: 10
    wildcards: nr=01, pre=

igdiscover germlinefilter --whitelist=database/V.fasta --unique-CDR3=5 --cluster-size=100 --unique-J=3 --cross-mapping-ratio=0.02 --clonotype-ratio=0.12 --exact-ratio=0.12 --cdr3-shared-ratio=0.8 --unique-D-ratio=0.3 --unique-D-threshold=10 --annotate=iteration-01/annotated_V_germline.tab --fasta=iteration-01/new_V_germline.fasta iteration-01/candidates.tab  2> >(tee iteration-01/new_V_germline.log >&2)  > iteration-01/new_V_germline.tab
[Tue Sep 10 10:17:00 2019]
Finished job 4.
9 of 28 steps (32%) done

[Tue Sep 10 10:17:00 2019]
rule igdiscover_germlinefilter:
    input: iteration-01/candidates.tab, database/V.fasta
    output: iteration-01/new_V_pregermline.tab, iteration-01/new_V_pregermline.fasta, iteration-01/annotated_V_pregermline.tab
    log: iteration-01/new_V_pregermline.log
    jobid: 11
    wildcards: nr=01, pre=pre

igdiscover germlinefilter --whitelist=database/V.fasta --allow-stop --unique-CDR3=2 --cluster-size=0 --unique-J=2 --cross-mapping-ratio=0.02 --clonotype-ratio=0.12 --exact-ratio=0.12 --cdr3-shared-ratio=0.8 --unique-D-ratio=0.3 --unique-D-threshold=10 --annotate=iteration-01/annotated_V_pregermline.tab --fasta=iteration-01/new_V_pregermline.fasta iteration-01/candidates.tab  2> >(tee iteration-01/new_V_pregermline.log >&2)  > iteration-01/new_V_pregermline.tab
[Tue Sep 10 10:17:02 2019]
Finished job 10.
10 of 28 steps (36%) done

[Tue Sep 10 10:17:02 2019]
rule copy_final_v_database:
    input: iteration-01/new_V_germline.fasta
    output: final/database/V.fasta
    jobid: 34

[Tue Sep 10 10:17:02 2019]
Finished job 11.
11 of 28 steps (39%) done

[Tue Sep 10 10:17:02 2019]
rule json_stats_nofinal:
    input: database/V.fasta, iteration-01/new_V_pregermline.fasta, iteration-01/new_V_germline.fasta, iteration-01/stats/filtered.json, stats/groups.json, stats/reads.json, stats/trimmed.json
    output: stats/stats_nofinal.json
    jobid: 15

[Tue Sep 10 10:17:03 2019]
Finished job 34.
12 of 28 steps (43%) done

[Tue Sep 10 10:17:03 2019]
rule dendrogram:
    input: final/database/V.fasta
    output: final/dendrogram_V.pdf
    jobid: 22
    wildcards: dir=final, gene=V

igdiscover dendrogram --mark database/V.fasta final/database/V.fasta final/dendrogram_V.pdf
[Tue Sep 10 10:17:03 2019]
Finished job 15.
13 of 28 steps (46%) done

[Tue Sep 10 10:17:03 2019]
rule copy_final_j_database:
    input: iteration-01/new_J.fasta
    output: final/database/J.fasta
    jobid: 36

[Tue Sep 10 10:17:04 2019]
Finished job 36.
14 of 28 steps (50%) done

[Tue Sep 10 10:17:04 2019]
rule dendrogram:
    input: final/database/J.fasta
    output: final/dendrogram_J.pdf
    jobid: 24
    wildcards: dir=final, gene=J

igdiscover dendrogram --mark database/J.fasta final/database/J.fasta final/dendrogram_J.pdf
[Tue Sep 10 10:17:05 2019]
Finished job 22.
15 of 28 steps (54%) done
[Tue Sep 10 10:17:06 2019]
Finished job 24.
16 of 28 steps (57%) done
[Tue Sep 10 10:17:06 2019]
Finished job 2.
17 of 28 steps (61%) done
[Tue Sep 10 10:17:13 2019]
Finished job 1.
18 of 28 steps (64%) done

[Tue Sep 10 10:17:13 2019]
rule igdiscover_igblast:
    input: reads/sequences.fasta.gz, final/database/V.fasta, final/database/D.fasta, final/database/J.fasta
    output: final/assigned.tab.gz, final/stats/assigned.json
    log: final/igblast.log
    jobid: 41
    wildcards: dir=final
    threads: 4

time igdiscover igblast --sequence-type=Ig --threads=4 --stats=final/stats/assigned.json final/database reads/sequences.fasta.gz | gzip 2>&1 > final/assigned.tab.gz | tee final/igblast.log >&2
[Tue Sep 10 10:18:12 2019]
Finished job 41.
19 of 28 steps (68%) done

[Tue Sep 10 10:18:12 2019]
rule check_parsing:
    input: final/stats/assigned.json
    output: final/stats/parsing-successful
    jobid: 42
    wildcards: dir=final

[Tue Sep 10 10:18:13 2019]
Finished job 42.
20 of 28 steps (71%) done

[Tue Sep 10 10:18:13 2019]
rule igdiscover_filter:
    input: final/assigned.tab.gz, final/stats/parsing-successful
    output: final/filtered.tab.gz, final/stats/filtered.json
    jobid: 33
    wildcards: dir=final

[Tue Sep 10 10:18:15 2019]
Finished job 33.
21 of 28 steps (75%) done

[Tue Sep 10 10:18:15 2019]
rule igdiscover_clusterplot:
    input: final/filtered.tab.gz
    output: final/clusterplots/done
    jobid: 17
    wildcards: dir=final

igdiscover clusterplot final/filtered.tab.gz final/clusterplots/ && touch final/clusterplots/done

[Tue Sep 10 10:18:15 2019]
rule igdiscover_count:
    input: final/filtered.tab.gz
    output: final/expressed_V.pdf, final/expressed_V.tab
    jobid: 19
    wildcards: dir=final, gene=V

igdiscover count --gene=V --allele-ratio=0.2 --plot=final/expressed_V.pdf final/filtered.tab.gz > final/expressed_V.tab

[Tue Sep 10 10:18:15 2019]
rule plot_errorhistograms:
    input: final/filtered.tab.gz
    output: final/errorhistograms.pdf, final/v-shm-distributions.pdf
    jobid: 18
    wildcards: dir=final

igdiscover errorplot --multi=final/errorhistograms.pdf --boxplot=final/v-shm-distributions.pdf final/filtered.tab.gz

[Tue Sep 10 10:18:15 2019]
rule igdiscover_count:
    input: final/filtered.tab.gz
    output: final/expressed_J.pdf, final/expressed_J.tab
    jobid: 21
    wildcards: dir=final, gene=J

igdiscover count --gene=J --allele-ratio=0.2 --plot=final/expressed_J.pdf final/filtered.tab.gz > final/expressed_J.tab
[Tue Sep 10 10:18:17 2019]
Finished job 21.
22 of 28 steps (79%) done

[Tue Sep 10 10:18:17 2019]
rule igdiscover_count:
    input: final/filtered.tab.gz
    output: final/expressed_D.pdf, final/expressed_D.tab
    jobid: 20
    wildcards: dir=final, gene=D

igdiscover count --gene=D --allele-ratio=0.2 --plot=final/expressed_D.pdf final/filtered.tab.gz > final/expressed_D.tab
[Tue Sep 10 10:18:17 2019]
Finished job 19.
23 of 28 steps (82%) done

[Tue Sep 10 10:18:17 2019]
rule json_stats:
    input: stats/stats_nofinal.json, final/stats/filtered.json
    output: stats/stats.json
    jobid: 25

[Tue Sep 10 10:18:17 2019]
Finished job 25.
24 of 28 steps (86%) done
[Tue Sep 10 10:18:18 2019]
Finished job 20.
25 of 28 steps (89%) done
[Tue Sep 10 10:18:19 2019]
Finished job 18.
26 of 28 steps (93%) done
[Tue Sep 10 10:18:36 2019]
Finished job 17.
27 of 28 steps (96%) done

[Tue Sep 10 10:18:36 2019]
Job 0: IgDiscover finished.

[Tue Sep 10 10:18:36 2019]
Finished job 0.
28 of 28 steps (100%) done
Complete log: /home/cofia/Documents/Project/Msc_Bioinformatics_Project/igdiscover_Trial/Data/discovertest/.snakemake/log/2019-09-10T101505.888822.snakemake.log
